<!DOCTYPE html>
<html lang="en-US">
<meta charset="utf-8" />

<head>
    <title>The Stronghold TV Wall Controller</title>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
</head>

<body>

    <P>
        <B>The Stronghold TV Wall Controller</B>
    </P>

    <hr/>
    <P>Power: &nbsp; &nbsp;
        <button id="powerOnBtn">TV On</button> &nbsp;
        <button id="powerOffBtn">TV Off</button>
    </P>

    <P> Select the TV(s) to operate on:</P>

    <LABEL for="tv1"><input type="checkbox" name="tv" value="tv1" id="tv1"/>TV 1</LABEL>
    <LABEL for="tv2"><input type="checkbox" name="tv" value="tv2" id="tv2"/>TV 2</LABEL>
    <LABEL for="tv3"><input type="checkbox" name="tv" value="tv3" id="tv3"/>TV 3</LABEL>
    <LABEL for="tv4"><input type="checkbox" name="tv" value="tv4" id="tv4"/>TV 4</LABEL>
    <LABEL for="tv5"><input type="checkbox" name="tv" value="tv5" id="tv5"/>TV 5</LABEL>
    <br/>
    <button id="tvToggleBtn">Toggle all TV's</button>

    <br/>

    <P>Inp:
        <button id="hdmi1Btn">Chromecast Input</button>
        <button id="homeBtn">Home Screen</button>
    </P>

    <P>Vol:
        <button id="volumeUpBtn">Volume Up</button>
        <button id="volumeDownBtn">Volume Down</button>
        <button id="volumeMuteBtn">Mute</button>
    </P>

    <P>Nav:
        <button id="upBtn">ðŸ¡©</button>
        <button id="downBtn">ðŸ¡«</button>
        <button id="leftBtn">ðŸ¡¨</button>
        <button id="rightBtn">ðŸ¡ª</button>
    </P>

    <button id="backBtn">Nav Bk</button>
    <button id="selectBtn">OK</button>
    <button id="repeatBtn">Repeat</button>
    <button id="infoBtn">Info (*)</button>

    <br/><br/>

    <button id="revBtn">RR</button>
    <button id="playBtn">Play</button>
    <button id="fwdBtn">FF</button>

    <script>
        // Roku remote reference: https://developer.roku.com/docs/developer-program/debugging/external-control-api.md
        // Roku dev tool that inspired this: http://devtools.web.roku.com/RokuRemote/

        const tvArray = {
            tv1: "http://192.168.86.40:8060",
            tv2: "http://192.168.86.43:8060",
            tv3: "http://192.168.86.41:8060",
            tv4: "http://192.168.86.29:8060",
            tv5: "http://192.168.86.42:8060"
        };

        //List of TV's in scope for operation

        const cbs = document.querySelectorAll('input[name="tv"]');

        //Functions associated with determining which TV's are in scope for operations

        const tvToggleBtn = document.querySelector('#tvToggleBtn');
        tvToggleBtn.onclick = checkAll;

        function check(checked = true) {
            cbs.forEach((cb) => {
                cb.checked = checked;
            });
        }

        function checkAll() {
            check();
            this.onclick = uncheckAll;
        }

        function uncheckAll() {
            check(false);
            this.onclick = checkAll;
        }

        //Helper functions to send the post request(s) for all operations

        function postRequest(cb, operation) {
            fetch(tvArray[cb.id].concat("/keypress/").concat(operation), {
                    method: "POST"
                })
                .then(res => {
                    console.log("done")
                })
        }

        function keyAction(reqAction) {
            cbs.forEach((cb) => {
                if (cb.checked) {
                    postRequest(cb, reqAction);
                }
            })
        }

        //Remote actions

        //PowerOn works, but it appears that if the TV's have been off for more than an hour they go into a deep sleep and will not
        //respond to this command.  The physical remote is needed to first turn the tv on.  This does work to turn a TV on that you
        //accidentilly turned them off.

        powerOnBtn.onclick = powerOn;

        function powerOn() {
            keyAction("PowerOn");
        }

        powerOffBtn.onclick = powerOff;

        function powerOff() {
            keyAction("PowerOff");
        }

        hdmi1Btn.onclick = setHDMI1Input;

        function setHDMI1Input() {
            keyAction("InputHDMI1");
        }

        homeBtn.onclick = setHomeInput;

        function setHomeInput() {
            keyAction("Home");
        }
        volumeUpBtn.onclick = volUp;

        function volUp() {
            keyAction("VolumeUp");
        }

        volumeDownBtn.onclick = volDown;

        function volDown() {
            keyAction("VolumeDown");
        }

        volumeMuteBtn.onclick = volMute;

        function volMute() {
            keyAction("VolumeMute");
        }

        backBtn.onclick = keyActionBack;

        function keyActionBack() {
            keyAction("Back");
        }

        upBtn.onclick = keyActionUp;

        function keyActionUp() {
            keyAction("Up");
        }

        downBtn.onclick = keyActionDown;

        function keyActionDown() {
            keyAction("Down");
        }

        leftBtn.onclick = keyActionLeft;

        function keyActionLeft() {
            keyAction("Left");
        }

        rightBtn.onclick = keyActionRight;

        function keyActionRight() {
            keyAction("Right");
        }

        selectBtn.onclick = keyActionSelect;

        function keyActionSelect() {
            keyAction("Select");
        }

        repeatBtn.onclick = keyActionRepeat;

        function keyActionRepeat() {
            keyAction("Repeat");
        }

        infoBtn.onclick = keyActionInfo;

        function keyActionInfo() {
            keyAction("Info");
        }

        revBtn.onclick = keyActionReverse;

        function keyActionReverse() {
            keyAction("Rev");
        }

        playBtn.onclick = keyActionPlay;

        function keyActionPlay() {
            keyAction("Play");
        }

        fwdBtn.onclick = keyActionForward;

        function keyActionForward() {
            keyAction("Fwd");
        }
    </script>

</html>
